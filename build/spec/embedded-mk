#!/bin/sh
set -e

# TODO: see if we can merge this and ./build/spec/mk

ROOTDIR=$(cd $(dirname $(dirname $(dirname $0))) && pwd -P)
if [ $? -ne 0 ]; then
    echo "$0: cannot determine root directory" 1>&2
    exit 1
fi

cd "${ROOTDIR}"
test -f Makefile && make clean
test -x configure || ./autogen.sh
dd=${pkg_prefix}/${pkg_cross}/${pkg_cross_arch}
./configure $pkg_configure_flags --with-libevent=${dd}                         \
            --with-geoip=${dd} --with-openssl=${dd}                            \
            --disable-examples --prefix=${dd}                                  \
            --disable-shared --disable-binaries
make $pkg_make_flags
make install-strip
