#!/bin/sh
set -e

if [ "$DOCKER_SPEC" != "" ]; then
    if [ "$TRAVIS_PULL_REQUEST_BRANCH" != "" ]; then
        BRANCH="$TRAVIS_PULL_REQUEST_BRANCH"
    else
        BRANCH="$TRAVIS_BRANCH"
    fi
    if [ "$DOCKER_BRANCHES_ONLY" = "" ]; then
        DOCKER_BRANCHES_ONLY=$BRANCH  # No constraints? Run always.
    fi
    if echo "$DOCKER_BRANCHES_ONLY" | grep -q "$BRANCH"; then
        ./build/docker/$DOCKER_SPEC
    else
        echo "Branch $BRANCH is not in '$DOCKER_BRANCHES_ONLY'"
        echo "Therefore we are not building this branch"
    fi
    exit 0
else
    echo "FATAL: Non docker builds no longer supported" 1>&2
    exit 1
fi
