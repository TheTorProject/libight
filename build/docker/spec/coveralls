#!/bin/sh
set -e
REPOROOT=$(cd $(dirname $(dirname $(dirname $(dirname $0)))) && pwd -P)
. $REPOROOT/build/docker/template/coverage
. $REPOROOT/build/docker/template/xenial

debian_deps="$debian_deps g++"
debian_deps="$debian_deps python"
debian_deps="$debian_deps python-pip"

subr_depend() {
    debian_depend
    pip install --user cpp-coveralls
}

subr_finalize() {
    /root/.local/bin/coveralls                                             \
                               --gcov-options '\-lp'                       \
                               --build-root .                              \
                               --exclude include/measurement_kit/ext       \
                               --exclude src/ext                           \
                               --exclude example                           \
                               --exclude third_party                       \
      > /dev/null;
}
