# Simplified build system

This directory contains the simplified build system. You can use this to
compile Measurement Kit or its dependencies in specific cases.

Sources are stored in

```
./MK_BUILD/<os>/<arch>/<package>/<package-sources-dir>
```

Artifacts are in

```
./MK_DIST/<os>/<arch>/<package>
```

Paths are relatives to the top level directory of Measurement Kit sources.

If a package needs another package, you need to compile that other package
first (or populate appropriately the `./MK_DIST` directory with artifacts
generated by a previous build).

## Build on Linux / macOS

Just call the script name after the dependency. E.g.:

```
./script/build/libressl
```

You can actually call these scripts from anywhere.

## Cross compile for iOS

We assume that you have a macOS system with Xcode installed and the command
line developer tools installed.

```
./script/build/cross-ios <os> <arch> ./script/build/<package>
```

To see available `<os>` and `<arch>` values, run `cross-ios` without arguments.

## Cross compile for Android

We assume that you have the NDK installed. Create a standalone Android toolchain
using the `android-toolchain` script. For example:

```
./script/build/android-toolchain <ndk-bundle-path> <arch>
```

Run the script without arguments to see all the available `<arch>` options.

The toolchain will be created in:

```
./MK_BUILD/android/toolchain/<arch>
```

Then cross compile using:

```
./script/build/cross-android <arch> ./script/build/<package>
```

## Compile for Windows

We assume that:

1. you have installed Visual Studio 2017 Community

2. you have installed CMake and opted to have `cmake.exe` inside your path
   during the install process (important!)

3. you have installed Ubuntu and `ubuntu.exe` is available from your
   developer command prompt (that should be the case)

4. you are typing commands from the Developer Command prompt specific of
   the architecture that you want to build for (i.e. x32 or x64)

5. you are inside the top-level directory of MK sources

```
cd script\build
build.bat <package>
```
