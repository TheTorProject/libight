# Simplified build system

This directory contains the simplified build system. You can use this to
compile, and cross compile, Measurement Kit and its dependencies. Specifically
the following are the _packages_ that you can compile:

- `geoip`: [geoip](https://github.com/maxmind/geoip-api-c)
- `libressl`: [libressl](https://github.com/libressl-portable)
- `libevent`: [libevent](https://github.com/libevent/libevent)
- `c-ares`: [c-ares](https://github.com/c-ares/c-ares)
- `mk`: [Mk](https://github.com/measurement-kit/measurement-kit) itself

If needed, the build system will fetch the required sources and possibly
apply patches. In such case, sources will live in

```
./MK_BUILD/<os>/<arch>/<package>/<package-sources-dir>/
```

Artifacts (i.e. libraries and headers) are in

```
./MK_DIST/<os>/<arch>/<package>/
```

Paths are relative to the top level directory of MK sources.

If a package needs another package, you need to compile that other package
first (or to populate appropriately `./MK_DIST/<os>/<arch>/<package>/` using
the artifacts generated by a previous build).

All the scripts except `build.bat` can actually be called from everywhere.

## Build on Linux / macOS

Just call the script named after the package to build. E.g.:

```
./script/build/libressl
```

In addition to Unix essential commands, you'll need:

- make
- autoconf and automake
- g++ or clang (must be C++14-capable)
- libstdc++ or libc++ (again must be C++14-capable)
- git
- libtool
- wget
- gpg

## Cross compile for iOS

We assume that you have a macOS system with Xcode installed and the command
line developer tools installed.

```
./script/build/cross-ios <os> <arch> ./script/build/<package>
```

To see available `<os>` and `<arch>` values, run `cross-ios` without arguments.

## Cross compile for Android

We assume that you have the NDK installed. Create a standalone Android toolchain
using the `android-toolchain` script:

```
./script/build/android-toolchain <ndk-bundle-path> <arch>
```

Run the script without arguments to see all the available `<arch>` options.
The toolchain will be created in:

```
./MK_BUILD/android/toolchain/<arch>/
```

Then cross compile using:

```
./script/build/cross-android <arch> ./script/build/<package>
```

## Compile for Windows

We assume that:

1. you have installed Visual Studio 2017 Community

2. you have installed CMake and opted to have `cmake.exe` inside your path
   during the install process (important, as that is not the default
   choice)

3. you have installed Ubuntu and `ubuntu.exe` is available from your
   path (that should be the case), and you have installed into Ubuntu
   on Windows all the Linux packages mentioned above when discussing
   building for Linux or macOS

4. you are typing inside the x32 or x64 Developer Command prompt

5. you `chdir`-ed into the top-level directory of MK sources

```
cd script\build
build.bat <package>
```
