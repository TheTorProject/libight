#!/bin/sh
set -e

failed=0
if ! command -v cmake.exe >/dev/null; then
    echo "FATAL: $0: please expand your PATH to include cmake.exe"
    echo 'E.g.: export PATH="$PATH:/mnt/c/Program Files/CMake/bin/cmake.exe"'
    echo 'Or, if you do not have cmake for windows, please install it'
    failed=1
fi
if ! command -v devenv.exe >/dev/null; then
    echo "FATAL: $0: please expand your PATH to include Visual Studio devenv.exe"
    echo 'E.g.: export PATH="$PATH:/mnt/c/Program Files (x86)/Microsoft Visual Studio/2017/Community/Common7/IDE/devenv.exe"'
    echo 'Or, if you do not have Visual Studio Community 2017 for windows, please install it'
    failed=1
fi
if [ $failed -ne 0 ]; then
    exit 1  # Delay failure to provide all information at once
fi

if [ $# -lt 1 ]; then
    echo "$0 <cmake-generator-type> [command [args...]]" 1>&2
    echo "E.g.: $0 '/mnt/c/Program Files/CMake/bin/cmake.exe'"
    echo " Run 'cmake.exe -G' to list all generator types"
    exit 1
fi

export pkg_os=windows
export pkg_windows_cmake_generator="$1"
shift

if echo "$pkg_windows_cmake_generator" | grep -q Win64; then
    export pkg_arch=x86_64
else
    export pkg_arch=i386
fi

if [ $# -gt 0 ]; then
    $@
else
    env
fi
