#!/bin/sh
set -e
export LC_ALL=C  # Stable sorting regardless of the locale

OFILE=cmake/AutoGeneratedTargets.cmake
echo "* Updating $OFILE"
echo "# Autogenerated by $0"                               > $OFILE
echo ""                                                   >> $OFILE
for SRC in `find example -type f -name \*.cpp|sort`; do
    BASENAME=`basename $SRC | sed 's/\.cpp$//g'`
    DIRNAME=`dirname $SRC`
    echo "mk_declare_example(\"$DIRNAME\" \"$BASENAME\")" >> $OFILE
done
echo ""                                                   >> $OFILE
for SRC in `find test -type f -name \*.cpp|sort`; do
    BASENAME=`basename $SRC | sed 's/\.cpp$//g'`
    DIRNAME=`dirname $SRC`
    echo "mk_declare_test(\"$DIRNAME\" \"$BASENAME\")"    >> $OFILE
done

echo "* Updating cmake/LibSources.txt"
find include src/libmeasurement_kit -type f -name \*.h -o -name \*.hpp \
  -o -name \*.c -o -name \*.cpp | sort | sed 's/^\./${MK_ROOT}/g' \
  > cmake/LibSources.txt

echo "* Updating cmake/BinSources.txt"
find src/measurement_kit -type f -name \*.h -o -name \*.hpp \
  -o -name \*.c -o -name \*.cpp | sort | sed 's/^\./${MK_ROOT}/g' \
  > cmake/BinSources.txt
