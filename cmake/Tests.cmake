# test

# Looking for declared tests? See cmake/AutoGenerated.cmake

if (${MK_BUILD_TESTS})
    enable_testing()
endif()

function(mk_declare_test _dir_name _name)
    if (${MK_BUILD_TESTS})
        string(REPLACE "/" "_" _full_name ${_dir_name})
        set(_full_name "${_full_name}_${_name}")
        set(_src_name "${_dir_name}/${_name}.cpp")
        add_executable(
            ${_full_name}
            ${MK_ROOT}/${_src_name}
        )
        set_target_properties(
            ${_full_name}
            PROPERTIES
            OUTPUT_NAME
            ${_name}
            RUNTIME_OUTPUT_DIRECTORY
            ${CMAKE_BINARY_DIR}/${_dir_name}
        )
        target_link_libraries(
            ${_full_name}
            libmeasurement_kit_static
            ${MK_LIBS}
        )
        add_test(
            ${_full_name}
            ${CMAKE_BINARY_DIR}/${_dir_name}/${_name}
        )
    endif()
endfunction()
